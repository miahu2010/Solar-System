<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Solar Dust XIV - Visual HUD</title>
    <style>
        :root { --bg: #000; --panel: rgba(20,20,20,0.6); --border: rgba(255,255,255,0.15); --accent: #0f0; --alert: #f00; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--bg); overflow: hidden; font-family: "Segoe UI", sans-serif; }
        #canvas-container { position: absolute; inset: 0; z-index: 1; }
        #input-video { display: none; }

        /* --- UI 层 --- */
        .ui { position: absolute; z-index: 10; width: 100%; height: 100%; pointer-events: none; color: #ccc; }
        
        /* 导航 */
        #nav { 
            position: absolute; top: 20px; left: 20px; width: 140px; 
            pointer-events: auto; max-height: 70vh; overflow-y: auto;
            background: var(--panel); backdrop-filter: blur(12px);
            border-radius: 6px; border: 1px solid var(--border); padding: 5px;
        }
        .btn {
            display: block; width: 100%; background: none; border: none;
            color: #888; text-align: left; padding: 8px 10px; cursor: pointer;
            font-size: 11px; transition: 0.2s; border-radius: 4px; border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .btn:hover { color: #fff; background: rgba(255,255,255,0.1); }
        .btn.active { color: #fff; font-weight: bold; background: rgba(255,255,255,0.2); border-left: 3px solid #fff; }

        /* 语言栏 */
        #lang-panel {
            position: absolute; top: 20px; right: 20px; 
            pointer-events: auto; display: flex; gap: 5px;
            background: var(--panel); padding: 5px; border-radius: 20px; border: 1px solid var(--border);
        }
        .lang-btn {
            background: none; border: none; color: #666; font-size: 10px; cursor: pointer; padding: 4px 8px; border-radius: 10px; transition: 0.2s;
        }
        .lang-btn.active { background: #fff; color: #000; font-weight: bold; }

        /* 行星信息 */
        #info-card {
            position: absolute; bottom: 120px; right: 20px; width: 260px;
            background: var(--panel); backdrop-filter: blur(12px);
            border: 1px solid var(--border); border-radius: 6px; padding: 20px;
            opacity: 0; transform: translateY(20px); transition: 0.4s;
        }
        #info-card.show { opacity: 1; transform: translateY(0); }
        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-family: monospace; font-size: 10px; color: #aaa; margin-top: 15px; }

        /* --- 仪表盘 (HUD) - 核心新增功能 --- */
        #hud-container {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 320px; background: rgba(0,0,0,0.8); border: 1px solid var(--border);
            border-radius: 8px; padding: 10px; display: flex; flex-direction: column; gap: 8px;
            backdrop-filter: blur(5px);
        }
        
        .hud-row { display: flex; justify-content: space-between; align-items: center; font-size: 10px; font-family: monospace; letter-spacing: 1px; }
        .hud-label { color: #666; }
        .hud-val { color: #fff; font-weight: bold; }
        
        /* 状态指示灯 */
        .status-box { display: flex; gap: 15px; }
        .indicator { display: flex; align-items: center; gap: 5px; }
        .led { width: 6px; height: 6px; border-radius: 50%; background: #333; transition: 0.3s; }
        .led.green { background: #0f0; box-shadow: 0 0 8px #0f0; }
        .led.red { background: #f00; box-shadow: 0 0 8px #f00; }
        .led.yellow { background: #ff0; box-shadow: 0 0 8px #ff0; }

        /* 进度条 */
        #gesture-bar-track { width: 100%; height: 4px; background: #222; border-radius: 2px; overflow: hidden; margin-top: 5px; }
        #gesture-bar-fill { width: 0%; height: 100%; background: var(--accent); transition: width 0.1s; }

        /* 启动页 */
        #cover {
            position: fixed; inset: 0; background: #000; z-index: 100;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.8s;
        }
        #btn-start {
            margin-top: 30px; background: transparent; border: 1px solid #444; color: #fff;
            padding: 12px 50px; letter-spacing: 6px; cursor: pointer; font-size: 12px;
            border-radius: 4px; transition: 0.3s;
        }
        #btn-start:hover { border-color: #fff; background: rgba(255,255,255,0.1); }
        
        #error-msg { color: #f00; font-size: 12px; margin-top: 10px; display: none; max-width: 300px; text-align: center; }

    </style>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
</head>
<body>

    <div id="cover">
        <div style="font-size: 28px; letter-spacing: 12px; color: #ddd;">SOLAR HUD</div>
        <div style="font-size: 10px; color: #666; margin-top: 10px;">VISUAL DEBUG EDITION</div>
        <button id="btn-start">INITIALIZE SYSTEM</button>
        <div id="error-msg"></div>
    </div>

    <div class="ui">
        <div id="nav"></div>
        
        <div id="lang-panel">
            <button class="lang-btn active" onclick="setLang('CN')">中</button>
            <button class="lang-btn" onclick="setLang('EN')">EN</button>
        </div>

        <div id="hud-container">
            <div class="hud-row" style="border-bottom:1px solid #222; padding-bottom:5px; margin-bottom:5px;">
                <span style="color:#888;">SYSTEM DIAGNOSTICS</span>
                <span id="sys-fps" style="color:#444;">60 FPS</span>
            </div>
            
            <div class="status-box">
                <div class="indicator">
                    <div class="led" id="led-cam"></div>
                    <span id="txt-cam">CAM: OFF</span>
                </div>
                <div class="indicator">
                    <div class="led" id="led-hand"></div>
                    <span id="txt-hand">HAND: NO</span>
                </div>
            </div>

            <div class="hud-row" style="margin-top:5px;">
                <span class="hud-label">DETECTED ACTION:</span>
                <span class="hud-val" id="val-action">--</span>
            </div>
            
            <div class="hud-row">
                <span class="hud-label">OPENNESS:</span>
                <span class="hud-val" id="val-open">0%</span>
            </div>
            <div id="gesture-bar-track"><div id="gesture-bar-fill"></div></div>
        </div>

        <div id="info-card">
            <h1 id="p-name" style="margin:0; font-weight:100; letter-spacing:2px; font-size:24px; color:#fff;">EARTH</h1>
            <span id="p-desc" style="font-size:10px; color:#888; text-transform:uppercase; letter-spacing:1px; display:block; margin-bottom:15px;">The Blue Marble</span>
            <div class="data-grid">
                <div class="data-item"><span>DIAMETER</span><div id="d-dia">12742</div></div>
                <div class="data-item"><span>TEMP</span><div id="d-tmp">15°C</div></div>
                <div class="data-item"><span>GRAVITY</span><div id="d-grav">9.8</div></div>
                <div class="data-item"><span>DAY</span><div id="d-day">24h</div></div>
            </div>
        </div>
    </div>

    <video id="input-video"></video>
    <div id="canvas-container"></div>

    <script type="x-shader/x-vertex" id="vShader">
        attribute float size;
        attribute vec3 mistOffset; 
        attribute float randomScale;
        uniform float uTime;
        uniform float uDisperse; 
        varying float vAlpha;
        void main() {
            vec3 solidPos = position;
            vec3 dispersedPos = solidPos + mistOffset * (1.0 + sin(uTime*0.5 + randomScale)*0.2);
            dispersedPos.x += sin(uTime*0.3 + randomScale*10.0)*3.0;
            dispersedPos.y += cos(uTime*0.2 + randomScale*20.0)*3.0;
            dispersedPos.z += sin(uTime*0.4 + randomScale*30.0)*3.0;
            vec3 finalPos = mix(solidPos, dispersedPos, uDisperse);
            float breath = 0.05 * (1.0 - uDisperse);
            finalPos *= 1.0 + sin(uTime*2.0 + randomScale*10.0)*breath;
            vec4 mvPosition = modelViewMatrix * vec4(finalPos, 1.0);
            float currentSize = size * (1.0 + uDisperse * 2.5);
            gl_PointSize = currentSize * (200.0 / -mvPosition.z);
            gl_Position = projectionMatrix * mvPosition;
            vAlpha = 0.9 - uDisperse * 0.6;
        }
    </script>
    <script type="x-shader/x-fragment" id="fShader">
        uniform sampler2D uTexture;
        uniform vec3 uColor;
        varying float vAlpha;
        void main() {
            vec4 tex = texture2D(uTexture, gl_PointCoord);
            if(tex.a < 0.05) discard;
            gl_FragColor = vec4(uColor, vAlpha * tex.r); 
        }
    </script>

    <script>
        // --- DATA & LANG ---
        const LANG = {
            CN: { 
                labels: { dia:"直径", tmp:"温度", grav:"重力", day:"自转" },
                sys: "星系全览", sun: "太阳", mer: "水星", ven: "金星", ear: "地球", mar: "火星", jup: "木星", sat: "土星", ura: "天王星", nep: "海王星",
                desc: { sun: "主序星", mer: "岩石行星", ven: "浓厚大气", ear: "蓝色星球", mar: "红色沙漠", jup: "气体巨星", sat: "光环行星", ura: "冰巨星", nep: "蓝色冰球" },
                hud: { cam_on: "摄像头: 运行中", cam_wait: "摄像头: 启动中", hand_no: "未检测到手", hand_yes: "捕捉: 手部", act_solid: "聚合 (实体)", act_mist: "弥散 (星云)", open: "张开度" }
            },
            EN: {
                labels: { dia:"DIAMETER", tmp:"TEMP", grav:"GRAVITY", day:"DAY" },
                sys: "SYSTEM VIEW", sun: "SUN", mer: "MERCURY", ven: "VENUS", ear: "EARTH", mar: "MARS", jup: "JUPITER", sat: "SATURN", ura: "URANUS", nep: "NEPTUNE",
                desc: { sun: "Main Sequence", mer: "Rocky World", ven: "Thick Atmosphere", ear: "Blue Marble", mar: "Red Desert", jup: "Gas Giant", sat: "Ringed Jewel", ura: "Ice Giant", nep: "Deep Blue" },
                hud: { cam_on: "CAM: ACTIVE", cam_wait: "CAM: INIT...", hand_no: "HAND: NO", hand_yes: "HAND: YES", act_solid: "SOLID (FIST)", act_mist: "MIST (OPEN)", open: "OPEN" }
            }
        };
        let curLang = 'CN';

        const DB = [
            { id: "sys", name: "System", color: [1,1,1], r: 0, d: 0, s: 0 },
            { id: "sun", name: "Sun", color: [1.0, 0.85, 0.6], r: 12, d: 0, s: 0, data: { dia:"1.39M km", tmp:"5500°C", grav:"274", day:"25 days" } },
            { id: "mer", name: "Mercury", color: [0.7, 0.7, 0.75], r: 2.2, d: 25, s: 0.8, data: { dia:"4879 km", tmp:"167°C", grav:"3.7", day:"58 days" } },
            { id: "ven", name: "Venus", color: [0.85, 0.8, 0.65], r: 3.8, d: 40, s: 0.6, data: { dia:"12104 km", tmp:"464°C", grav:"8.87", day:"243 days" } },
            { id: "ear", name: "Earth", color: [0.3, 0.55, 0.8], r: 4.0, d: 60, s: 0.5, data: { dia:"12742 km", tmp:"15°C", grav:"9.8", day:"24h" } },
            { id: "mar", name: "Mars", color: [0.8, 0.4, 0.3], r: 2.8, d: 80, s: 0.4, data: { dia:"6779 km", tmp:"-65°C", grav:"3.71", day:"24h 37m" } },
            { id: "jup", name: "Jupiter", color: [0.75, 0.7, 0.6], r: 10, d: 115, s: 0.2, data: { dia:"139820 km", tmp:"-110°C", grav:"24.79", day:"9h 55m" } },
            { id: "sat", name: "Saturn", color: [0.8, 0.75, 0.65], r: 9, d: 150, s: 0.15, ring: true, data: { dia:"116460 km", tmp:"-140°C", grav:"10.44", day:"10h 33m" } },
            { id: "ura", name: "Uranus", color: [0.6, 0.8, 0.85], r: 7, d: 185, s: 0.1, data: { dia:"50724 km", tmp:"-195°C", grav:"8.69", day:"17h 14m" } },
            { id: "nep", name: "Neptune", color: [0.35, 0.45, 0.85], r: 7, d: 220, s: 0.08, data: { dia:"49244 km", tmp:"-200°C", grav:"11.15", day:"16h 6m" } }
        ];

        let scene, camera, renderer, controls;
        let uniforms, planets = [], activeIdx = -1;
        let state = { disperse: 0.0, targetDisperse: 0.0 }; 

        // --- INIT ---
        document.getElementById('btn-start').addEventListener('click', () => {
            document.getElementById('btn-start').innerText = "CONNECTING...";
            // 尝试启动
            initVideo().then(() => {
                document.getElementById('cover').style.opacity = 0;
                setTimeout(() => document.getElementById('cover').style.display = 'none', 800);
                init3D();
                updateUILang();
            }).catch(err => {
                console.error(err);
                document.getElementById('btn-start').style.display = 'none';
                const msg = document.getElementById('error-msg');
                msg.style.display = 'block';
                msg.innerHTML = "CAMERA ERROR: " + err.message + "<br><br>请确保在 HTTPS 或 Localhost 环境下运行。<br>并允许浏览器访问摄像头。";
            });
        });

        // --- 3D ENGINE ---
        function createGlowTexture() {
            const c = document.createElement('canvas'); c.width=64; c.height=64;
            const ctx = c.getContext('2d');
            const g = ctx.createRadialGradient(32,32,0,32,32,32);
            g.addColorStop(0,'rgba(255,255,255,1)'); g.addColorStop(0.3,'rgba(255,255,255,0.5)'); g.addColorStop(1,'rgba(0,0,0,0)');
            ctx.fillStyle=g; ctx.fillRect(0,0,64,64);
            return new THREE.CanvasTexture(c);
        }

        function init3D() {
            const container = document.getElementById('canvas-container');
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x000000, 0.001);
            camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 2000);
            camera.position.set(0, 100, 200);
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.setClearColor(0x000000);
            container.appendChild(renderer.domElement);
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true; controls.enablePan = false; controls.autoRotate = true; controls.autoRotateSpeed = 0.3; controls.maxDistance = 500;
            
            uniforms = { uTime: { value: 0 }, uDisperse: { value: 0.0 }, uTexture: { value: createGlowTexture() } };
            
            createStars();
            createSystem();
            createNav();
            animate();
            window.addEventListener('resize', onResize);
        }

        function createSystem() {
            DB.forEach((d, i) => {
                if(i===0) return;
                const pivot = new THREE.Group(); scene.add(pivot);
                const meshGroup = new THREE.Group(); pivot.add(meshGroup);
                
                // Layers
                createLayer(meshGroup, d, d.r*0.7, d.id==="sun"?2000:800, 1.2, 1.0);
                createLayer(meshGroup, d, d.r*1.0, d.id==="sun"?3000:1500, 1.5, 0.8);
                if(d.id!=="mer") createLayer(meshGroup, d, d.r*1.3, 600, 2.5, 0.4);
                if(d.ring) createRing(meshGroup, d);
                
                meshGroup.position.x = d.d;

                // Orbit
                if(d.d>0) {
                    const pts=[]; for(let j=0; j<=128; j++){ const a=(j/128)*Math.PI*2; pts.push(new THREE.Vector3(Math.cos(a)*d.d,0,Math.sin(a)*d.d)); }
                    const geo=new THREE.BufferGeometry().setFromPoints(pts);
                    const mat=new THREE.LineBasicMaterial({color:0xffffff, transparent:true, opacity:0.08, blending:THREE.AdditiveBlending});
                    scene.add(new THREE.LineLoop(geo, mat));
                }
                planets.push({id:d.id, pivot:pivot, meshGroup:meshGroup, speed:d.s*0.003, data:d});
            });
        }

        function createLayer(group, data, radius, count, sizeScale, alphaScale) {
            const geo = new THREE.BufferGeometry();
            const solidPos=[], mistOffset=[], randomScale=[], sizes=[];
            const baseColor = new THREE.Color(data.color[0], data.color[1], data.color[2]);
            const hsl = {}; baseColor.getHSL(hsl);
            for(let k=0; k<count; k++) {
                const r=radius, theta=Math.random()*Math.PI*2, phi=Math.acos(Math.random()*2-1);
                solidPos.push(r*Math.sin(phi)*Math.cos(theta), r*Math.sin(phi)*Math.sin(theta), r*Math.cos(phi));
                const spread=data.r*8.0;
                mistOffset.push((Math.random()-0.5)*spread, (Math.random()-0.5)*spread, (Math.random()-0.5)*spread);
                randomScale.push(Math.random()); sizes.push((Math.random()*1.5+0.5)*sizeScale);
            }
            geo.setAttribute('position', new THREE.Float32BufferAttribute(solidPos, 3));
            geo.setAttribute('mistOffset', new THREE.Float32BufferAttribute(mistOffset, 3));
            geo.setAttribute('randomScale', new THREE.Float32BufferAttribute(randomScale, 1));
            geo.setAttribute('size', new THREE.Float32BufferAttribute(sizes, 1));
            const col = baseColor.clone().setHSL(hsl.h, hsl.s, hsl.l * alphaScale);
            const mat = new THREE.ShaderMaterial({
                uniforms: { ...uniforms, uColor: { value: col } },
                vertexShader: document.getElementById('vShader').textContent,
                fragmentShader: document.getElementById('fShader').textContent,
                blending: THREE.AdditiveBlending, depthWrite: false, transparent: true
            });
            group.add(new THREE.Points(geo, mat));
        }

        function createRing(group, data) {
            const geo = new THREE.BufferGeometry();
            const solidPos=[], mistOffset=[], randomScale=[], sizes=[];
            for(let k=0; k<1200; k++) {
                const r=data.r*(1.5+Math.random()*1.5), theta=Math.random()*Math.PI*2;
                solidPos.push(r*Math.cos(theta), (Math.random()-0.5)*0.3, r*Math.sin(theta));
                mistOffset.push((Math.random()-0.5)*data.r*6, (Math.random()-0.5)*data.r*6, (Math.random()-0.5)*data.r*6);
                randomScale.push(Math.random()); sizes.push(Math.random()*1.2+0.5);
            }
            geo.setAttribute('position', new THREE.Float32BufferAttribute(solidPos, 3));
            geo.setAttribute('mistOffset', new THREE.Float32BufferAttribute(mistOffset, 3));
            geo.setAttribute('randomScale', new THREE.Float32BufferAttribute(randomScale, 1));
            geo.setAttribute('size', new THREE.Float32BufferAttribute(sizes, 1));
            const mat = new THREE.ShaderMaterial({
                uniforms: { ...uniforms, uColor: { value: new THREE.Color(0.8, 0.75, 0.6) } },
                vertexShader: document.getElementById('vShader').textContent,
                fragmentShader: document.getElementById('fShader').textContent,
                blending: THREE.AdditiveBlending, depthWrite: false, transparent: true
            });
            group.add(new THREE.Points(geo, mat));
        }

        function createStars() {
            const geo = new THREE.BufferGeometry(); const pos=[];
            for(let i=0; i<3000; i++){ const r=500+Math.random()*500, theta=Math.random()*Math.PI*2, phi=Math.acos(Math.random()*2-1); pos.push(r*Math.sin(phi)*Math.cos(theta), r*Math.sin(phi)*Math.sin(theta), r*Math.cos(phi)); }
            geo.setAttribute('position', new THREE.Float32BufferAttribute(pos, 3));
            scene.add(new THREE.Points(geo, new THREE.PointsMaterial({color:0x444444, size:2, transparent:true, opacity:0.6})));
        }

        function animate() {
            requestAnimationFrame(animate);
            const time = performance.now() * 0.001;
            uniforms.uTime.value = time;
            TWEEN.update();

            // 手势插值
            state.disperse += (state.targetDisperse - state.disperse) * 0.08;
            uniforms.uDisperse.value = state.disperse;
            
            // 更新 HUD 数据
            updateHUD(state.disperse);

            planets.forEach(p => { p.pivot.rotation.y += p.speed; });

            if (activeIdx !== -1) {
                const target = planets[activeIdx - 1];
                if (target) {
                    const worldPos = new THREE.Vector3();
                    target.meshGroup.getWorldPosition(worldPos);
                    controls.target.copy(worldPos);
                }
            }
            controls.update();
            renderer.render(scene, camera);
        }

        // --- HUD LOGIC ---
        function updateHUD(val) {
            const fill = document.getElementById('gesture-bar-fill');
            const txtVal = document.getElementById('val-open');
            const txtAct = document.getElementById('val-action');
            const t = LANG[curLang].hud;

            fill.style.width = (val * 100) + '%';
            txtVal.innerText = Math.round(val * 100) + '%';

            if(val > 0.5) {
                fill.style.backgroundColor = '#0f0'; // Green
                txtAct.innerText = t.act_mist;
                txtAct.style.color = '#0f0';
            } else {
                fill.style.backgroundColor = '#444'; 
                txtAct.innerText = t.act_solid;
                txtAct.style.color = '#888';
            }
        }

        // --- CAMERA LOGIC ---
        async function initVideo() {
            const video = document.getElementById('input-video');
            const ledCam = document.getElementById('led-cam');
            const txtCam = document.getElementById('txt-cam');
            
            txtCam.innerText = LANG[curLang].hud.cam_wait;
            ledCam.className = "led yellow";

            const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
            hands.setOptions({maxNumHands: 1, minDetectionConfidence: 0.5});
            
            hands.onResults(res => {
                const t = LANG[curLang].hud;
                const ledHand = document.getElementById('led-hand');
                const txtHand = document.getElementById('txt-hand');

                if(res.multiHandLandmarks.length > 0) {
                    ledHand.className = "led green";
                    txtHand.innerText = t.hand_yes;
                    
                    const lm = res.multiHandLandmarks[0];
                    // 改进的手势判定：指尖扩散度
                    const width = Math.hypot(lm[8].x - lm[20].x, lm[8].y - lm[20].y);
                    const palmSize = Math.hypot(lm[0].x - lm[9].x, lm[0].y - lm[9].y);
                    
                    // 阈值判定
                    if (width > palmSize * 1.3) {
                        state.targetDisperse = 1.0; 
                    } else {
                        state.targetDisperse = 0.0;
                    }
                } else {
                    ledHand.className = "led red";
                    txtHand.innerText = t.hand_no;
                    state.targetDisperse = 0.0;
                }
            });
            
            const cam = new Camera(video, { onFrame: async () => { await hands.send({image: video}); }, width: 320, height: 240 });
            await cam.start();
            
            ledCam.className = "led green";
            txtCam.innerText = LANG[curLang].hud.cam_on;
        }

        // --- UI & LANG ---
        window.setLang = function(l) { curLang = l; updateUILang(); }
        function updateUILang() {
            const t = LANG[curLang];
            DB.forEach((d,i) => {
                const btn = document.getElementById(`nav-${i}`);
                if(btn) btn.innerText = t[d.id] || d.name;
            });
            if(activeIdx !== -1) {
                const d = DB[activeIdx];
                document.getElementById('p-name').innerText = (t[d.id] || d.name).toUpperCase();
                document.getElementById('p-desc').innerText = t.desc[d.id];
                document.querySelectorAll('.data-item span').forEach((el, idx) => {
                    const keys = ["dia","tmp","grav","day"];
                    el.innerText = t.labels[keys[idx]];
                });
            }
            // Update HUD static text
            document.getElementById('txt-cam').innerText = document.getElementById('led-cam').classList.contains('green') ? t.hud.cam_on : t.hud.cam_wait;
        }

        function createNav() {
            const nav = document.getElementById('nav');
            DB.forEach((d, i) => {
                const btn = document.createElement('button');
                btn.className = 'btn'; btn.id = `nav-${i}`;
                btn.innerText = d.name;
                if(i===0) btn.classList.add('active');
                btn.onclick = () => focusView(i);
                nav.appendChild(btn);
            });
        }

        function focusView(idx) {
            activeIdx = idx;
            document.querySelectorAll('.btn').forEach((b,i)=>b.classList.toggle('active', i===idx));
            const info = document.getElementById('info-card');
            if(idx===0) {
                activeIdx = -1; info.classList.remove('show'); controls.autoRotate = true;
                new TWEEN.Tween(camera.position).to({x:0, y:100, z:200}, 1500).easing(TWEEN.Easing.Cubic.Out).start();
                new TWEEN.Tween(controls.target).to({x:0, y:0, z:0}, 1500).start();
            } else {
                controls.autoRotate = false;
                updateUILang();
                const d = DB[idx];
                document.getElementById('d-dia').innerText = d.data.dia;
                document.getElementById('d-tmp').innerText = d.data.tmp;
                document.getElementById('d-grav').innerText = d.data.grav;
                document.getElementById('d-day').innerText = d.data.day;
                info.classList.add('show');
                controls.minDistance = d.r*2.5;
                const target = planets[idx-1];
                const worldPos = new THREE.Vector3();
                target.meshGroup.getWorldPosition(worldPos);
                const offset = worldPos.clone().normalize().multiplyScalar(d.r*5+30); offset.y+=15;
                const camEnd = worldPos.clone().add(offset);
                new TWEEN.Tween(camera.position).to({x:camEnd.x, y:camEnd.y, z:camEnd.z}, 1500).easing(TWEEN.Easing.Cubic.Out).start();
            }
        }
        function onResize() { camera.aspect=window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); }
    </script>
</body>
</html>
